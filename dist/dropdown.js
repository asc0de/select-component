!function(){function e(e){r.call(this);var t,n=l(),i=(t={},Object.defineProperty(t,"ARROW_LEFT",{value:37,writable:!1}),Object.defineProperty(t,"ARROW_UP",{value:38,writable:!1}),Object.defineProperty(t,"ARROW_RIGHT",{value:39,writable:!1}),Object.defineProperty(t,"ARROW_DOWN",{value:40,writable:!1}),Object.defineProperty(t,"SHIFT",{value:16,writable:!1}),Object.defineProperty(t,"ALT",{value:17,writable:!1}),t);e=e||{},this.element=e.element,this.mode=e.mode||n.SINGLE_SELECT,this.filterEnabled=e.filter||!1,this.searchEnabled=e.search||!1,this.avatarEnabled=e.avatar||!1,this.dataProp=e.dataProp||"id",this.labelProp=e.labelProp||"name",this.notFoundLabel=e.notFoundLabel||"Результатов не найдено",this.service=new a,this.selectedItems=[],this.initItems=e.items,this.items=e.items,this.getValue=function(){return this.mode===n.SINGLE_SELECT?this.items[0]:this.mode===n.MULTI_SELECT?this.items:void 0},this.onSelect=function(t){var e=this.items.filter(function(e){return e[this.dataProp]===t}.bind(this));if(e&&e.length){var i=e[0];i.collectionIndex=this.items.indexOf(i),this.selectedItems.push(i),this.filterItemsBySelected(),this.mode===n.SINGLE_SELECT?this.detachEvents():this.collection.render(),this.input.setSelectedItems(this.selectedItems),this.input.inputElement.value=""}},this.onRemove=function(e){var t=this.selectedItems.splice(this.selectedItems.map(function(e){return e[this.dataProp]}.bind(this)).indexOf(e),1)[0];this.items.splice(t.collectionIndex,0,t),this.collection.render(),0===this.selectedItems.length&&this.mode===n.SINGLE_SELECT&&this.attachEvents(),this.input.setSelectedItems(this.selectedItems),this.input.tagsCollection.render()},this.input=new h(this.element,{placeholder:e.placeholder,selectedItems:this.selectedItems,onRemove:this.onRemove.bind(this),mode:this.mode}),this.collection=new o(this.element,{mode:this.mode,avatarEnabled:this.avatarEnabled,onSelect:this.onSelect.bind(this),getWidth:this.input.getWidth.bind(this.input),notFoundLabel:this.notFoundLabel});var s=function(e){this.filterEnabled&&(this.items=this.initItems,this.filterItemsBySelected()),this.collection.appendDom(),this.setCollectionItemsAndRender()};this.setCollectionItemsAndRender=function(){this.collection.setItems(this.items),this.collection.render()},this.filterItemsBySelected=function(){var i=this.selectedItems.map(function(e){return e[this.dataProp]}.bind(this));this.items=this.items.reduce(function(e,t){return-1==i.indexOf(t[this.dataProp])&&e.push(t),e}.bind(this),[]),this.collection.setItems(this.items)},this.attachEvents=function(){this.input.addEvent("blur",function(e){this.collection.detachFromDom(),this.input.inputElement.value=""}.bind(this),!0),this.input.addEvent("click",s.bind(this),!0),this.input.addEvent("focus",s.bind(this),!0)},this.detachEvents=function(){this.input.removeEvent("blur"),this.input.removeEvent("click"),this.input.removeEvent("focus")},this.appendDom=function(){this.element.innerHTML="",this.element.classList.add("vk-dropdown"),this.input.appendDom();var e=this.helper.debounce(function(e){switch(e.keyCode){case i.ARROW_LEFT:case i.ARROW_TOP:case i.ARROW_RIGHT:case i.ARROW_DOWN:case i.ALT:break;default:this.items=this.initItems,this.filterEnabled&&(this.items=this.service.search(e.target.value,this.items),this.filterItemsBySelected(),this.setCollectionItemsAndRender()),this.searchEnabled&&this.service.fetchUsers(e.target.value,function(e){this.items=e,this.setCollectionItemsAndRender()}.bind(this))}}.bind(this));this.filterEnabled||this.searchEnabled?this.input.addEvent("keyup",e,300,this):this.input.disable(),this.attachEvents()},this.appendDom()}function a(){(function(){var l=(e={},Object.defineProperty(e,"serverUrl",{value:"http://localhost:8000/api/",writable:!1}),e);var e;this.get=function(e,t){var i,n,s,a;i=e,n="GET",s=t,(a=new XMLHttpRequest).open(n,l.serverUrl+i,!0),a.onload=function(){s(JSON.parse(a.responseText||{}))},a.send()}}).call(this);var h=d();this.languageHelper=new c,this.fetchUsers=function(e,t){this.get("users?search="+e,t)},this.search=function(o,e,t){return(e=e||[]).length?e.filter(function(e){var i=e.name.toLowerCase(),t=[],n=this.languageHelper.transform("ru","en",h.KEYBOARD,o),s=this.languageHelper.transform("en","ru",h.KEYBOARD,o),a=this.languageHelper.transform("en","ru",h.PRONOUNCE,o),l=this.languageHelper.transform("ru","en",h.PRONOUNCE,o);return null!==n&&(t.push(n),t.push(this.languageHelper.transform("en","ru",h.PRONOUNCE,n))),null!==s&&t.push(s),null!==a&&t.push(a),null!==l&&t.push(l),t.push(o),t.reduce(function(e,t){return null!==t&&(e=e||-1!=i.indexOf(t)),e},!1)}.bind(this)):e}}function l(){var e={};return Object.defineProperty(e,"SINGLE_SELECT",{value:1,writable:!1}),Object.defineProperty(e,"MULTI_SELECT",{value:2,writable:!1}),e}function o(e,t){n.call(this,e),this.mode=t.mode||u.SINGLE_SELECT,this.avatarEnabled=t.avatarEnabled||!1,this.dataProp=t.dataProp||"id",this.notFoundLabel=t.notFoundLabel||"Результатов не найдено",this.onSelect=t.onSelect,this.items=[],this.setItems=function(e){this.items=e||[]},this.onSelect=function(e){t.onSelect(e),this.hide()},this.render=function(){if(this.clearElement(),this.items.length)this.items.forEach(function(e){new i(this.element,e,{avatarEnabled:this.avatarEnabled,onSelect:this.onSelect.bind(this)}).appendDom(e)}.bind(this));else{var e=document.createElement("DIV");e.innerText=this.notFoundLabel,e.classList.add("vk-dropdown-collection--not-found"),this.element.appendChild(e)}},this.createElement=function(){this.element=document.createElement("DIV"),this.element.classList.add("vk-dropdown-collection"),t.getWidth&&(this.element.style.width=(t.getWidth()||200)+"px"),this.render()}}function h(e,t){n.call(this,e);var i=l();this.placeholder=t.placeholder||"",this.selectedItems=t.selectedItems||[],this.mode=t.mode||i.SINGLE_SELECT,this.setSelectedItems=function(e){this.tagsCollection.setSelectedItems(e),1===e.length&&this.mode===i.SINGLE_SELECT&&this.handleSelectedSingleMode(),0===e.length&&this.mode===i.SINGLE_SELECT&&this.handleUnselectedSingleMode(),this.tagsCollection.render()},this.createElement=function(){this.element=document.createElement("DIV"),this.element.classList.add("vk-dropdown__input"),this.tagsCollection=new s(this.element,this.selectedItems,{labelProp:t.labelProp,dataProp:t.dataProp,onRemove:t.onRemove}),this.tagsCollection.appendDom();var e=document.createElement("INPUT");this.placeholder&&(e.placeholder=this.placeholder),this.inputElement=e,this.element.appendChild(this.inputElement)},this.handleSelectedSingleMode=function(){this.inputElement.placeholder="",this.element.classList.add("vk-dropdown__input--selected")},this.handleUnselectedSingleMode=function(){this.inputElement.placeholder=this.placeholder,this.element.classList.remove("vk-dropdown__input--selected")},this.getWidth=function(){return this.element.offsetWidth-2},this.disable=function(){this.element.childNodes[1].setAttribute("disabled","disabled")},this.enable=function(){this.element.childNodes[1].removeAttribute("disabled")}}function r(){this.helper=new t}function n(e){r.call(this),this.parent=e,this.events=[],this.appended=!1;var n=function(e){this.element||this.createElement(e)};this.createElement=function(){throw new Error('"createElement" function should be implemented for child elements')},this.appendDom=function(e){n.call(this,e),this.appended?this.show():(this.parent.appendChild(this.element),this.appended=!0)},this.detachFromDom=function(e){e?(this.parent.removeChild(this.element),this.appended=!1):this.hide()},this.hide=function(){this.element.style.display="none"},this.show=function(){this.element.style.display=""},this.addEvent=function(e,t,i){n.call(this),i=i||!1,this.element.addEventListener(e,t,i),this.events.push({name:e,callback:t,useCapture:i})},this.removeEvent=function(t){n.call(this);var e=this.events.filter(function(e){return t===e.name})[0];this.events.splice(this.events.map(function(e){return e.name}).indexOf(t),1),this.element.removeEventListener(e.name,e.callback,e.useCapture)},this.destroyElement=function(){this.events.forEach(function(e){this.removeEvent(e.name)}.bind(this)),this.detachFromDom()},this.clearElement=function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild)}}function t(){this.debounce=function(e,t,i){var n;return function(){args=arguments,clearTimeout(n),n=setTimeout(function(){n=null,e.apply(i,args)},t||500)}}}function i(e,a,t){n.call(this,e),this.item=a,this.avatarEnabled=t.avatarEnabled||!1,this.dataProp=t.dataProp||"id",this.onSelectItem=function(e){e.stopPropagation(),t.onSelect(parseInt(this.element.getAttribute("data-value"),10))},this.createElement=function(e){if(this.element=document.createElement("DIV"),this.element.classList.add("vk-dropdown-collection__item"),this.element.setAttribute("data-value",this.item[this.dataProp]),this.avatarEnabled){var t=document.createElement("DIV");t.style.backgroundImage="url("+a.imgUrl+")",t.classList.add("vk-dropdown-collection__item__image"),this.element.appendChild(t)}var i=document.createElement("DIV");i.classList.add("vk-dropdown-collection__item__info");var n=document.createElement("SPAN");n.innerHTML=e.name,i.appendChild(n);var s=document.createElement("SPAN");s.innerHTML=e.university,i.appendChild(s),this.element.appendChild(i),this.addEvent("mousedown",this.onSelectItem.bind(this))}}function s(e,t,i){n.call(this,e),this.items=t,this.dataProp=i.dataProp||"id",this.labelProp=i.labelProp||"name",this.setSelectedItems=function(e){this.items=e},this.render=function(){this.clearElement(),this.items.forEach(function(e){new m(this.element,e,{labelProp:this.labelProp,dataProp:this.dataProp,onRemove:i.onRemove}).appendDom(e)}.bind(this))},this.createElement=function(){this.element=document.createElement("DIV"),this.element.classList.add("vk-tags-collection")}}function d(){var e={};return Object.defineProperty(e,"KEYBOARD",{value:1,writable:!1}),Object.defineProperty(e,"PRONOUNCE",{value:2,writable:!1}),e}function c(){var r=d();this.transform=function(t,i,e,n){var s={},a="";e===r.KEYBOARD&&(s=this.dictionary.keyboard),e===r.PRONOUNCE&&(s=this.dictionary.pronounce);var l=s.filter(function(e){return e.from===t&&e.to===i})[0];if(!l)return a;for(var o=0;o<n.length;o++){var h=l.dictionary[n.charAt(o)];if(!h)return null;a+=h}return a},this.getReversedMapping=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t},this.dictionary={keyboard:[{from:"en",to:"ru",dictionary:{q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","`":"ё"}},{from:"ru",to:"en",dictionary:this.getReversedMapping({q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","`":"ё"})}],pronounce:[{from:"en",to:"ru",dictionary:{a:"а",b:"б",c:"с",d:"д",e:"е",f:"ф",g:"г",h:"х",i:"и",j:"дж",k:"к",l:"л",m:"м",n:"н",o:"о",p:"п",q:"",r:"р",s:"с",t:"т",u:"у",v:"в",w:"в",x:"кс",y:"у",z:"з"}},{from:"ru",to:"en",dictionary:this.getReversedMapping({a:"а",b:"б",c:"с",d:"д",e:"е",f:"ф",g:"г",h:"х",i:"и",j:"дж",k:"к",l:"л",m:"м",n:"н",o:"о",p:"п",q:"",r:"р",s:"с",t:"т",u:"у",v:"в",w:"в",x:"кс",y:"у",z:"з"})}]}}function m(e,t,i){n.call(this,e),this.item=t,this.dataProp=i.dataProp||"id",this.labelProp=i.labelProp||"name",this.onRemove=i.onRemove,this.createElement=function(){this.element=document.createElement("DIV"),this.element.classList.add("vk-tags-collection__tag"),this.element.setAttribute("data-value",this.item[this.dataProp]),this.element.innerText=this.item[this.labelProp]};this.addEvent("mousedown",function(e){e.stopPropagation(),this.onRemove(parseInt(e.target.getAttribute("data-value"),10))}.bind(this),!0)}var u=l(),p=[{id:1,imgUrl:"https://pp.userapi.com/c841339/v841339466/51b24/unRuQrPG6kA.jpg?ava=1v",name:"Илья Суховей",university:"БГТУ (Военмех)"},{id:2,imgUrl:"https://pp.userapi.com/c846021/v846021248/79dc8/VdouMjPTBy0.jpg?ava=1",name:"Альбина Деханова",university:""},{id:3,imgUrl:"https://pp.userapi.com/c841338/v841338120/3b14c/kjybYosMc_0.jpg?ava=1",name:"Василий Котов",university:""},{id:4,imgUrl:"https://pp.userapi.com/c624626/v624626708/3fdbe/z1YhrwafU64.jpg?ava=1",name:"Марина Полякова",university:"СПбГХФА"},{id:5,imgUrl:"https://pp.userapi.com/c629320/v629320419/3349a/V3t3mqmJMiE.jpg?ava=1",name:"Максим Левшин",university:""}];new e({element:document.getElementById("dropdown1"),items:p}),new e({element:document.getElementById("dropdown2"),placeholder:"Выберите друга",avatar:!0,items:p}),new e({element:document.getElementById("dropdown3"),placeholder:"Выберите друзей",avatar:!0,mode:u.MULTI_SELECT,items:p}),new e({element:document.getElementById("dropdown4"),placeholder:"Введите имя",avatar:!0,filter:!0,mode:u.MULTI_SELECT,items:p}),new e({element:document.getElementById("dropdown5"),placeholder:"Введите имя",avatar:!0,search:!0,mode:u.MULTI_SELECT,items:p})}();